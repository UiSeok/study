#  테스트 컨텍스트 프레임워크



스프링이 가져온 가장 큰 혜택 중 하나는 테스트다.
기술에 종속적이지 않은 코드를 작성하게 해 준다.









## 6.1 테스트 컨텍스트 프레임워크

- 스프링은 테스트에 사용되는 **Application-context**를 생성, 관리하고 테스트에 적용해주는 기능을 가진 **테스트 프레임워크**를 제공한다.










### 6.1.1 테스트 프레임워크와 컨텍스트 테스트

- 자바에서는 JUnit과 TestNG를 주로 사용한다. 
* JUnit은 기존의 JUnit3와 어노테이션 방식인 JUnit 4를 모두 지원한다.
* 기본적으로 두 방식은 어플리케이션 컨텍스트를 사용하는 방식에서 큰 차이가 없다. (책에서는 JUnit으로 설명)

* * *


### 테스트용 애플리케이션 컨텍스트 캐싱과 설정파일

- JUnit 4에서는 특정 클래스를 상속하지 않아도 테스트 코드를 작성할 수 있다.
- @Test 어노테이션만 붙이면 각각이 독립적인 테스트 코드가 된다.
- 테스트 코드가 하나라도 들어있는 클래스는 테스트 클래스가 된다.


다만 테스트가 독립적이라고 해서 스프링 컨테이너를 새로 만드는 건 매우 비 효율적이다.

**때문에 스프링에서는 테스트의 컨텍스트를 캐싱해서 동일 구성의 테스트에 같은 컨텍스트를 공유하도록 한다.**

테스트에 테스트 컨텍스트 프레임워크를 적용하려면 테스트 클래스에 두 가지 어노테이션을 부여해줘야 한다.
1. @RunWith(SpringJUnit4ClassRunner.class) : JUnit테스트를 실행하는 Runner를 스프링이 제공해주는 것으로 변경
2. @ContextConfiguration("/test-applicationContext") : 어플리케이션 테스트 컨텍스트가 생성 및 공유된다.
    ContextConfiguration 에 이름을 지정해주지 않으면 하위 패키지에 해당 클래스네임 + '-context.xml' 이 붙은 파일이 디폴트 이름으로 설정된다.
    즉 ~/test/{ClassName}-context.xml인 설정파일을 가진 것으로 간주한다.






### 컨텍스트 설정의 상속과 컨텍스트 로더

JUnit 4의 장점은 테스트 클래스타 특정 클래스를 상속하도록 강제하지 않는다는 것이다.
즉 필요에 의해 상속도 가능하다는 뜻이다.

슈퍼 클래스와 서브 클래스에서 모두 컨텍스트 파일을 지정하면 어떻게 될까?

- 슈퍼 클래스와 서브 클래스 모두 설정파일이 있다면 서브 클래스는 기본적으로 슈퍼클래스의 설정파일과 자신의 설정파일 **2개**를 가지게 된다.
- 슈퍼 클래스의 ContextConfiguration을 무시하고 새롭게 정의하고 싶다면 서브 클래스에서 **inheritLocations = false**로 지정하면 된다.
- 기본적으로는 GenericXmlContextLoader를 이용해서 xml파일로 다른 컨텍스트를 만드는 방법을 적용한다.


### 6.1.2 테스트 코드의 테스트 컨텍스트 활용

기본적으로 이 용어에서의 **'컨텍스트'** 는 어플리케이션 컨텍스트가 아니다. 테스트에 사용되는 어플리케이션 컨텍스트를 생성 및 관리해주는 오브젝트를 가리키는 용어다.



* * *

### 테스트 컨텍스트로부터 DI받기

- 테스트 클래스는 테스트 컨텍스트로부터 어플리케이션 컨텍스트와 그에 담긴 빈을 제공받아 테스트 코드에 사용한다.
- 테스트 클래스는 그 자체로는 빈이 아니지만 @Autowired, @Resource등을 사용해 어플리케이션 컨텍스트의 빈을 DI 받을 수 있다.
- 테스트 클래스에서 사용할 수 있는 DI용 어노테이션은 @Autowired, @Resource외에도 @Qualifier, @Inject, @Named, @Provider, @Required등이 있다.





### 공유 컨텍스트 사용 시 주의할 점

- 캐싱된 컨텍스트의 공유는 편리하나 독점자원이 아니므로 자원의 변경에 유의해야 한다.
- 내부 리소스 만큼이나 외부 리소스 변경에도 주의해야 한다.
- 일부 데이터를 꼭 변경해야하는 테스트의 경우 **@DirtiesContext** 테스트를 이용하면 테스트가 수행된 후 테스트 컨텍스트를 강제로 제거한다.
- @DirtiesContext를 클래스 레벨에 부여할 수 있다. ClassMode.AFTER_EACH_TEST_METHOD를 이용하면 된다.





* * *



